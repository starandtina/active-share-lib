!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("backbone"),require("jquery"),require("underscore"),require("HTMLWrapper")):"function"==typeof define&&define.amd?define(["backbone","jquery","underscore","HTMLWrapper"],t):"object"==typeof exports?exports.ActiveShareLib=t(require("backbone"),require("jquery"),require("underscore"),require("HTMLWrapper")):e.ActiveShareLib=t(e.backbone,e.jquery,e.underscore,e.HTMLWrapper)}(this,function(e,t,n,r){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Reflux=t.BackboneBaseView=void 0;var i=n(2),o=r(i),s=n(7),u=r(s);t.BackboneBaseView=o["default"],t.Reflux=u["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){e&&(d["default"].isFunction(e.stopListening)&&e.stopListening(),d["default"].isFunction(e.stopListeningToAll)&&e.stopListeningToAll())}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(3),c=(r(a),n(4)),f=r(c),h=n(5),d=r(h),p=n(6),v=r(p);Backbone.View.prototype.close=function(){return d["default"].chain(this.$el.find("[data-render]").toArray()).filter(function(e){return(0,f["default"])(e).data("_impl")}).map(function(e){return v["default"].getComponent(e)}).compact().filter(function(e){return d["default"].isFunction(e.dispose)}).invoke("dispose"),this.onClose&&this.onClose(),u.call(this,this.model),u.call(this,this.collection),this.remove(),this.off(),this};var y=function(e){function t(e){i(this,t);var n=o(this,Object.getPrototypeOf(t).call(this,e));n.name=null,n.parentView=null,d["default"].bindAll.apply(d["default"],[n].concat(d["default"].functions(n))),n.options=d["default"].extend(n.options||{},e||{}),n.name=n.name||d["default"].uniqueId("view");var r=[].concat(n.mixins);return d["default"].forEach(r,function(e){d["default"].extend(this,e)},n),n}return s(t,e),l(t,[{key:"getInnerHtml",value:function(){var e=this.getTemplate(),t=this.getTemplateData();if(this._preRender(),null==e)throw new Error(this.name+': template "'+this.getTemplateName()+'" not found.');return v["default"].localize.parse(e(t))}},{key:"getTemplate",value:function(){return this.template}},{key:"getTemplateName",value:function(){return this.name}},{key:"getTemplateData",value:function(){var e,t;return this.model?e=this.model.toJSON():this.collection&&(e={models:this.collection.toJSON(),meta:this.collection.meta,params:this.collection.params}),t=d["default"].omit(this.options,["model","collection","meta","params"]),d["default"].extend({},e,t)}},{key:"getAttributes",value:function(){var e={};return e["data-view"]=this.name,e}},{key:"_preRender",value:function(){this.trigger("preRender")}},{key:"_postRender",value:function(){return this.removeChildViews(),this.addReferences(),this.trigger("postRender"),this}},{key:"_preRenderComponents",value:function(){this.trigger("preRenderComponents")}},{key:"_postRenderComponents",value:function(){var e=this._references||d["default"].result(this,"references");for(var t in e)this[t]=v["default"].getComponent(this.$(e[t]));this.trigger("postRenderComponents")}},{key:"onRenderComponentsDone",value:function(){v["default"].app.applyPermissionsToHtml(this.$el),v["default"].app.applyFeaturesToHtml(this.$el),this._postRenderComponents()}},{key:"render",value:function(){var e=this,t=this.getInnerHtml();return this.$el.html(t),this.$el.attr(this.getAttributes()),this._postRender(),this._preRenderComponents(),v["default"].render(this.$el,function(){return e.onRenderComponentsDone()}),this}},{key:"preRender",value:function(){}},{key:"postRender",value:function(){}},{key:"preRenderComponents",value:function(){}},{key:"postRenderComponents",value:function(){}},{key:"registerChildView",value:function(e,t){var n=this.getChildViews();return t=t||e.cid,n[t]=e,e.el&&(e.parent=e.parentView=this),e}},{key:"registerSubview",value:function(){this.registerChildView.apply(this,arguments)}},{key:"renderChildViews",value:function(e,t){var n;return d["default"].isObject(e)?n=e:(n={},n[e]=t),n?(d["default"].each(n,function(e,t){e.parent=e.parentView=this,e.selector=t,e.appendToParent?(e.name=t,e.render(),this.$el.append(e.el)):e.setElement(this.$(t)).render(),this.registerChildView(e)},this),this):void 0}},{key:"assign",value:function(){this.renderChildViews.apply(this,arguments)}},{key:"where",value:function(e,t){var n=d["default"].matches(e),r=this.getChildViews();return this[t?"find":"filter"](r,function(e){return n(e)})}},{key:"find",value:function(){return d["default"].find.apply(d["default"],arguments)}},{key:"filter",value:function(){return d["default"].filter.apply(d["default"],arguments)}},{key:"findWhere",value:function(e){return this.where(e,!0)}},{key:"getChildViewsByName",value:function(e){return this.where({name:e})}},{key:"getChildViewByName",value:function(e){return this.findWhere({name:e})}},{key:"getChildViewBySelector",value:function(e){return this.findWhere({selector:e})}},{key:"getSubViewBySelector",value:function(){return this.getChildViewBySelector.apply(this,arguments)}},{key:"trigger",value:function(e){return d["default"].isFunction(this[e])&&this[e].apply(this,[].slice.call(arguments,1)),Backbone.View.prototype.trigger.apply(this,arguments),this}},{key:"renderCollection",value:function(e,t,n,r){function i(e){return d["default"].find(l,function(t){return e===t.model})}function o(e,r,o){var s,f=a.filter?a.filter(e):!0;f&&(e.set("_isLast",o.length-1===r,{silent:!0}),s=i(e),s||(s=new t(d["default"].chain({model:e,collection:o}).extend(a.viewOptions).value()),l.push(s),s.parent=u,s.renderedByParentView=!0,s.render({containerEl:n}),u.registerChildView(s)),s.insertSelf||c[a.reverse?"prepend":"append"](s.el),s.delegateEvents())}function s(){if(0!==e.length){var t=c[0],n=d["default"].toArray(t.childNodes);d["default"].each(n,function(e){t.removeChild(e)}),e.each(o)}}var u=this,l=[],a=d["default"].defaults(r||{},{filter:null,viewOptions:{},reverse:!1}),c=this.$(n);this.listenTo(e,"add",o),this.listenTo(e,"remove",function(e){var t=l.indexOf(i(e));-1!==t&&l.splice(t,1)[0].remove()}),this.listenTo(e,"move sort",s),this.listenTo(e,"refresh reset",function(){for(;l.length;)l.pop().remove();s()}),s()}},{key:"addReferences",value:function(e){e=e||d["default"].result(this,"references"),this._references=d["default"].defaults({},this._references,e);for(var t in e)this["$"+t]=this.$(e[t])}},{key:"references",value:function(){return d["default"].reduce(d["default"].result(this,"dom")||{},function(e,t,n){return e[d["default"].camelize(n.toLocaleLowerCase())]=t,e},{})}},{key:"exit",value:function(e){this.removeChildViews(),this.childViews=null,this.parentView=null;var t=this.model||this.collection;t&&t.off(null,null,this),this.close(),this.trigger("remove"),e.complete()}},{key:"removeChildViews",value:function(){return d["default"].forEach(this.getChildViews(),function(e,t){this.removeChildView(e,t)},this),this}},{key:"removeChildView",value:function(e,t){t=t||e.cid,e&&d["default"].isFunction(e.close)&&e.close();var n=this.getChildViews();delete n[t]}},{key:"getChildViews",value:function(){return this.childViews=this.childViews||{},this.childViews}},{key:"enter",value:function(){return this.render(),this.$el}}]),t}(Backbone.View);t["default"]=y,e.exports=t["default"]},function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),o=n(11),s=r(o),u=n(12),l=r(u),a={};a.createAction=i.createAction,a.createActions=i.createActions,a.createStore=s["default"],a.Model=l["default"],t["default"]=a,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){e=e||{},_.isObject(e)||(e={actionName:e});for(var t in e)if(!a[t]&&s["default"][t])throw new Error("Cannot override API method "+t+" in action creation. Use another method name instead.");var n=0,r={};for(e.children=e.children||[];n<e.children.length;n++){var o=e.children[n];r[o]=i(o)}var u=_.defaults({eventEmitterToken:"action",emitter:_.extend({},new l["default"])},s["default"],new l["default"],e),c=function f(){return f.emit.apply(f,arguments)};return _.extend(c,u,r),c}Object.defineProperty(t,"__esModule",{value:!0}),t.createActions=t.createAction=void 0;var o=n(9),s=r(o),u=n(10),l=r(u),a={preEmit:1,shouldEmit:1},c=function(){var e=function(e,t){var n=_.keys(e);_.forEach(n,function(n){var r=e[n];t[n]=i(r)})};return function(t){var n={};return _.isArray(t)?t.forEach(function(t){_.isObject(t)?e(t,n):n[t]=i(t)}):e(t,n),n}}();t.createAction=i,t.createActions=c},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={preEmit:function(){},shouldEmit:function(){return!0},listen:function(e,t){t=t||this;var n=function(n){i||e.apply(t,n)},r=this,i=!1;return this.emitter.on(this.eventEmitterToken,n),function(){i=!0,r.emitter.off(r.eventEmitterToken,n)}},emit:function(){var e=arguments,t=this.preEmit.apply(this,e);e=void 0===t?e:_.isArguments(t)?t:[].concat(t),this.shouldEmit.apply(this,e)&&this.emitter.emit(this.eventEmitterToken,e)}},e.exports=t["default"]},function(e,t,n){"use strict";function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(){}var o=Object.prototype.hasOwnProperty,s="function"!=typeof Object.create?"~":!1;i.prototype._events=void 0,i.prototype.eventNames=function(){var e,t=this._events,n=[];if(!t)return n;for(e in t)o.call(t,e)&&n.push(s?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},i.prototype.listeners=function(e,t){var n=s?s+e:e,r=this._events&&this._events[n];if(t)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,u=new Array(o);o>i;i++)u[i]=r[i].fn;return u},i.prototype.emit=function(e,t,n,r,i,o){var u=s?s+e:e;if(!this._events||!this._events[u])return!1;var l,a,c=this._events[u],f=arguments.length;if("function"==typeof c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),f){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,i),!0;case 6:return c.fn.call(c.context,t,n,r,i,o),!0}for(a=1,l=new Array(f-1);f>a;a++)l[a-1]=arguments[a];c.fn.apply(c.context,l)}else{var h,d=c.length;for(a=0;d>a;a++)switch(c[a].once&&this.removeListener(e,c[a].fn,void 0,!0),f){case 1:c[a].fn.call(c[a].context);break;case 2:c[a].fn.call(c[a].context,t);break;case 3:c[a].fn.call(c[a].context,t,n);break;default:if(!l)for(h=1,l=new Array(f-1);f>h;h++)l[h-1]=arguments[h];c[a].fn.apply(c[a].context,l)}}return!0},i.prototype.on=function(e,t,n){var i=new r(t,n||this),o=s?s+e:e;return this._events||(this._events=s?{}:Object.create(null)),this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],i]:this._events[o].push(i):this._events[o]=i,this},i.prototype.once=function(e,t,n){var i=new r(t,n||this,!0),o=s?s+e:e;return this._events||(this._events=s?{}:Object.create(null)),this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],i]:this._events[o].push(i):this._events[o]=i,this},i.prototype.removeListener=function(e,t,n,r){var i=s?s+e:e;if(!this._events||!this._events[i])return this;var o=this._events[i],u=[];if(t)if(o.fn)(o.fn!==t||r&&!o.once||n&&o.context!==n)&&u.push(o);else for(var l=0,a=o.length;a>l;l++)(o[l].fn!==t||r&&!o[l].once||n&&o[l].context!==n)&&u.push(o[l]);return u.length?this._events[i]=1===u.length?u[0]:u:delete this._events[i],this},i.prototype.removeAllListeners=function(e){return this._events?(e?delete this._events[s?s+e:e]:this._events=s?{}:Object.create(null),this):this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.prefixed=s,e.exports=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=s["default"].extend(e);return new t}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i;var o=n(12),s=r(o);e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),o=r(i),s=n(5),u=r(s),l=n(13),a=r(l),c=n(9),f=r(c),h=n(10),d=r(h),p=u["default"].extend({},{constructor:function(){if(this.emitter=new d["default"],this.eventEmitterToken="store-change",this.listenables)for(var e=[].concat(this.listenables),t=0;t<e.length;t++)this.listenToMany(e[t]);o["default"].Model.apply(this,arguments)}},a["default"],f["default"]);t["default"]=o["default"].Model.extend(p),e.exports=t["default"]},function(e,t){"use strict";function n(e){return e.charAt(0).toUpperCase()+e.slice(1)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){for(var t,n={},r=0;r<(e.children||[]).length;++r)t=e.children[r],e[t]&&(n[t]=e[t]);return n},i=function s(e){var t={};for(var i in e){var o=e[i],u=r(o),l=s(u);t[i]=o;for(var a in l){var c=l[a];t[i+n(a)]=c}}return t},o=function(e,t){return t=t||"on",t+n(e)};t["default"]={listenToActionOrStore:function(e,t){if(e&&_.isFunction(e,"listen")){var n=this.subscriptions=this.subscriptions||[],r=e.listen(this[t]||t,this),i=function(){var e=n.indexOf(o);-1!==e&&(n.splice(e,1),r())},o={stop:i,listenable:e};return n.push(o),o}},stopListeningTo:function(e){for(var t,n=this.subscriptions||[];t<n.length;t++){var r=n[t];if(r.listenable===e)return r.stop(),!0}return!1},stopListeningToAll:function(){for(var e,t=this.subscriptions||[];e=t.length;)t[0].stop()},listenToMany:function(e){var t=i(e);for(var n in t){var r=o(n),s=this[r]?r:this[n]?n:void 0;s&&this.listenToActionOrStore(t[n],s)}}},e.exports=t["default"]}])});